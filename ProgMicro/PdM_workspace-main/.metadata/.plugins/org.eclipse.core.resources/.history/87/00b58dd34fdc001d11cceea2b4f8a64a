/*
 * port.c
 *
 *  Created on: 16 abr. 2023
 *      Author: denis
 */
#include "mpu9265_SPI.h"
#include "stm32f4xx_hal_spi.h"
#include "stm32f4xx_hal_gpio.h"

#define SPI_CS_Pin GPIO_PIN_1
#define SPI_CS_GPIO_Port GPIOB

SPI_HandleTypeDef hspi1;

void CSEnable(){
	HAL_GPIO_WritePin(SPI_CS_GPIO_Port, SPI_CS_Pin, GPIO_PIN_RESET);
}

void CSDisable(){
	HAL_GPIO_WritePin(SPI_CS_GPIO_Port, SPI_CS_Pin, GPIO_PIN_SET);
}

void SPIRead(uint8_t reg, uint16_t *data, uint8_t length){
	/* Putting a one in the MSB position of the register direction means
	 in the mpu that it is a read operation */
	reg = reg(1<<8);
	HAL_SPI_Transmit(&hspi1, &reg, 1, 100);
	HAL_SPI_Receive(&hspi1, data, len, 100);
}

void SPIWrite(uint8_t reg, uint16_t *data, uint8_t length){
	HAL_SPI_Transmit(&hspi1, &reg, 1, 100);
	HAL_SPI_Receive(&hspi1, data, len, 100);
}
